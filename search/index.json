[{"content":"目的 　現在私はRPi4で500GBのファイルサーバーを運用しているが，何もバックアップといった障害対策を行ってはこなかった．ストレージ系のパーツは往々にして突然壊れて公開後に立たずなことがあると伝えられてきているので，何か対策を打つことにした．\n手段 　HDDを追加購入して増設，RAID1アレイを構築することで目的を達成する．この構想はRPiを購入した時からあったが，RPiのUSB給電能力が貧弱（HDD相手なので仕方ないが）だったためY字ケーブル（下図）を購入する必要があり，結果的にHDD1台の運用となっていた．\n 今回使用したY字ケーブル \n作業工程 1. Y字ケーブルの取り付け 　取り付けました．（下図）\n 取り付けたところ．上に載っているのはRPi4 \n2. 追加したディスクの初期化 sudo fdisk -l を実行する．すると以下の図のように現在認識されている記憶領域のリストが表示される．\n 実行結果 \n次にfdiskで既存のパーティションを削除，新しく作成した．このときNTFSの管理情報が残っているという警告があったが，ext4で運用する予定なので削除した．\nsudo fdisk /dev/sdb  実行結果 \nもともとあったディスクはsdaとして認識されていたので，今回追加したディスクはsdbとして認識されていることになる．\n以上でディスクの初期化は完了した．\n3. RAIDデバイスを作成する 　この作業をする前にmdadmをインストールしておく必要がある．今回はRaspbian上なのでapt installでインストールした．また，apt upgradeした際は再起動しておくこと（常識だった）．ファイルの更新で齟齬が生じるのかそのままではmdadmでアレイを構築できなかった．\n再起動後\nsudo mdadm --create /dev/md0 --auto=yes --level=raid1 --raid-devices=2 missing /dev/sdb1 コマンドを実行する．（下図）\n RAIDデバイスを作成する \nつぎに\ncat /proc/mdstat で作成できたか確認する．\n うまくいった \nmkfs.ext4 /dev/md0 を実行してext4でフォーマットして，\n ext4でフォーマット \n下準備は完了．\n4. SAMBA，fstabの設定 　既存のハードディスクをRaidに組み込みたいが現在sambaの保存フォルダとして設定されている．まずこれを外すためにrsyncなどで作成したRAIDアレイにコピーしておくか，バックアップを作成する．これはのちの操作を誤った際の保険にもなるので必ず行うこと．\nつぎに/etc/samba/smb.confの赤線の場所をRAIDアレイのマウント先に設定しておく．\n私はこの作業を行う前にRAIDアレイをマウントし，既存のハードディスク内のデータをコピーしておいたのでそこを指定した．またコピー先のディレクトリに権限を付与することを忘れないようにすること．\n pathの設定 \n　つぎにfstabを設定する．下記のように設定した．\n fstabの設定 \n5. 既存のハードディスクをext4でフォーマットした後mdadmで追加 　最後に既存のハードディスクをフォーマットし，下記の通りのコマンドを実行しRAIDアレイに追加したら完了．\nsudo mkfs.ext4 /dev/sda1 sudo mdadm /dev/md0 --add /dev/sda1 cat /proc/mdstat  最終工程 \n同期が完了するのを待って再起動，無事にファイルの追加・削除ができることが確認できた．\n終わりに 　やはりインターネットは偉大だ．調べたものをつなぎ合わせてなんとかここまでたどり着くことができた．明日はテストなので残り時間は勉強しなきゃ・・・\n今後はradiko自動録音スクリプトなどを作成していきたい．\n参考文献 非RAIDシステムのRAID化 - CentOSで自宅サーバー構築 https://centossrv.com/centos5-raid-2.shtml\nStep by Step: シングルHDDをRAID 1に変換; LVM on RAID編 (Fedora 20) | Netsphere Laboratories https://www.nslabs.jp/raid1-convert.rhtml\nfstab - ArchWiki https://wiki.archlinux.jp/index.php/Fstab\n【 blkid 】コマンド――ブロックデバイスの属性を表示する：Linux基本コマンドTips（182） - ＠IT https://atmarkit.itmedia.co.jp/ait/articles/1802/09/news019.html\n◇mdadmによるRAIDの解除◇初心者のためのLinuxサーバー構築講座(CentOS 自宅サーバー対応)☆お便利サーバー.com☆ http://ftp.lumica.co.jp/_raid_create/delete_mdadm.html\nソフトウェアRAID の初期設定と運用 - mdadm - Qiita https://qiita.com/k__murayama/items/659edf3257cc2f1211a5\nSambaでファイルサーバーを構築しよう：基礎から理解するLinuxサーバー［Cent OS 7.0編］（8）（1/3 ページ） - ＠IT https://atmarkit.itmedia.co.jp/ait/articles/1612/01/news184.html\nchmodでファイルのパーミッションを再帰的に変更する | ⬢ Appirits spirits https://spirits.appirits.com/doruby/8785/\n","date":"2021-10-04T07:47:36+09:00","image":"https://www.munolike.com/p/create-raid-array-with-used-disk/computer_harddisk_hu39c2173c1f820dafcf87592b99ab96e4_247617_120x120_fill_box_smart1_3.png","permalink":"https://www.munolike.com/p/create-raid-array-with-used-disk/","title":"現在使用中のディスクを残したままRAID1アレイを構築する"},{"content":"今後なにをしたいのか とりあえずVue.jsを学んでなにか手軽なwebアプリを１個作成したい．候補としては，\n 脳内10秒と現実の10秒をピッタリにできるか検証するもの．アニメーションもつけれれば👍 山キャッチ Apexの戦績をグラフ化して表示 といった感じ．  ほかにはせっかくRaspberry Pi Zeroを買ったのでラジオを使ったガジェットを作ってみたい．Rustを使ったベアメタルTCP/IP通信もしてみたい． でもまずはラジオ録音鯖かな．RPi4がメディア鯖として腐ってるし．Golangで書くと思う．\nまたほかには それはそうと，私にプログラミングのアルゴリズム周りの教養が足りなさすぎるのでatcorders青目指したい感じはある． SECCONも面白そう．ApexのUEFIチートとかどんな仕組みになっているのだろう．\nとりまGithubに草を生やすのも兼ねて記事作成．こんなこと言ってるけどまずは普通にやっていなかった学校の科目を復習せねば．．．\n","date":"2021-09-10T22:49:13+09:00","image":"https://www.munolike.com/p/future-development-plan-2021/head_hud98cbaa966c39a6de3a4f2284f1b9598_247293_120x120_fill_q75_box_smart1.jpg","permalink":"https://www.munolike.com/p/future-development-plan-2021/","title":"今後の開発予定"},{"content":"Github Actionsで公開カギ，秘密鍵の登録でハマった ・解決法は簡単でデプロイ元のSecretsにはssh-keygenで生成したファイルのうち，拡張子なしのほうの中身を登録．デプロイ先のDeploy keysには拡張子pubのファイルの中身を登録する．\nまた，パスフレーズはなしでやること．デプロイ中にパスフレーズの入力を求められて停止してしまった．デプロイ元-デプロイ先だけでしか使わないのでここはパスフレーズなしの鍵を登録することにした\n接続するとindex.htmlが表示されずxmlソースが表示されてしまう 原因はthemeがgit submoduleとして認識されていてブログソースのリポジトリに取り込まれていないことが原因．これを解決するには２つの方法があり，github actionsでビルドするときにsubmoduleを取り込むように設定するやり方と，submoduleを削除する方法がある．私はやっつけでブログを作ってしまったためthemesフォルダ内のテーマファイルを直接いじってしまっていた．そのためsubmoduleを削除する方法でやることにした．\n以下の\ngit rm --cached themes/(テーマフォルダディレクトリ) を実行し，手動でthemes/(テーマフォルダディレクトリ)内の.gitフォルダを削除するという荒業でなんとかした．本当はテーマをフォークしたものを使うべきなのだろうが今回はこういうことにする．\n","date":"2021-09-05T06:20:43+09:00","image":"https://www.munolike.com/p/what-was-i-stuck-on/sc1_hu19f5a13a9b3d5847544a9689cb3326aa_13854_120x120_fill_box_smart1_3.png","permalink":"https://www.munolike.com/p/what-was-i-stuck-on/","title":"Github PagesにHugoサイトを投稿するうえで詰まったところ"},{"content":"こんにちは これが初めての投稿になると思うとなかなか書くのが難しいです． そのうち適当に技術系の記事を書くと思います．\n全然違って燻製つくったりしてるかも．とりあえず最近とったダブハン間近の画像でも上げておきます．\n Apex 3700ダメ \n","date":"2021-09-03T12:57:30+09:00","image":"https://www.munolike.com/p/hello-world/pagehead_hucde175c80ffa216c17c34254f7098003_229846_120x120_fill_q75_box_smart1.jpg","permalink":"https://www.munolike.com/p/hello-world/","title":"Hello World"}]